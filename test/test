#! /bin/bash


echo ========== TEST lib_firesight.so =============
echo target/test 
target/test
if [ $? -ne 0 ] 
then 
	echo FAILED: target/test
	exit 1
fi

echo ========== TEST firesight =============
if [ `uname -m` == "x86_64" -o "$WINDIR" != "" ]; then suffix64="-64"; else suffix64="" ; fi
echo "Machine platform is:" `uname -m`
echo "Test suffix is:$suffix64"

suffix=""
test/test-one duck.jpg resize "$suffix" "-Dfx=0.25" "-Dfy=0.5"
if [ $? -ne 0 ] ; then exit 1 ; fi

suffix="-64"
test/test-one pcb.png matchAngle "$suffix" "-Dangle=[45]" "-Dtemplate=img/tmplt-37x29.jpg"
if [ $? -ne 0 ] ; then exit 1 ; fi

suffix="-64"
test/test-one pcb.png matchCCOEFF_NORMED "$suffix" 
if [ $? -ne 0 ] ; then exit 1 ; fi

suffix="-64"
test/test-one pcb.png match45 "$suffix"
if [ $? -ne 0 ] ; then exit 1 ; fi

suffix=""
test/test-one pcb.png absdiff "$suffix" "-Dimg=img/mog2.png" -ji 0
if [ $? -ne 0 ] ; then exit 1 ; fi

suffix=""
test/test-one absdiff.png threshold "64$suffix" "-Dthresh=64" 
if [ $? -ne 0 ] ; then exit 1 ; fi
test/test-one absdiff.png threshold "64-color$suffix" "-Dthresh=64" "-Dgray=false"
if [ $? -ne 0 ] ; then exit 1 ; fi
test/test-one absdiff.png threshold "64-inv$suffix" "-Dthresh=64" "-Dtype=THRESH_BINARY_INV"
if [ $? -ne 0 ] ; then exit 1 ; fi

suffix=$suffix64
test/test-one whiterect.jpg dft-spectrum "$suffix" 
if [ $? -ne 0 ] ; then exit 1 ; fi

suffix=""
test/test-one headcam1.jpg calcOffset "-1$suffix" -Dtemplate=img/headcam0.jpg
if [ $? -ne 0 ] ; then exit 1 ; fi
test/test-one headcam0a.jpg calcOffset "-0a$suffix" -Dtemplate=img/headcam0.jpg
if [ $? -ne 0 ] ; then exit 1 ; fi
test/test-one headcam2.jpg calcOffset "-1BGR$suffix" -Dtemplate=img/headcam0.jpg -Dchannels=[0,1,2]
if [ $? -ne 0 ] ; then exit 1 ; fi
test/test-one headcam1.jpg calcOffset "-1roi$suffix" -Dtemplate=img/headcam0.jpg -Droi=[380,75,35,35]
if [ $? -ne 0 ] ; then exit 1 ; fi

suffix=$suffix64
test/test-one mog2.png bgsub "-mog2$suffix" "-DbgImg=img/pcb.png" "-Dmethod=MOG2"
if [ $? -ne 0 ] ; then exit 1 ; fi
test/test-one mog2.png bgsub "-absdiff$suffix" "-DbgImg=img/pcb.png" "-Dmethod=absdiff" "-Dthresh=32"
if [ $? -ne 0 ] ; then exit 1 ; fi

echo "-------------------------------------------------"
echo "BLISS AND HAPPINESS. FireSight TESTS ALL PASS!!!"
echo "-------------------------------------------------"
